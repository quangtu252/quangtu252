#include<stdio.h>
#include<conio.h>
# include <io.h> 
#include <fcntl.h> 
#include <string.h> 
#include <stdlib.h> 
#include <wchar.h> 

struct SV {
	wchar_t MSSV[10];
	wchar_t Ten[30];
	wchar_t Khoa[30];
	int khoa;
	wchar_t Ngaysinh[20];
	wchar_t Hinhanh[30];
	wchar_t Motabanthan[1000];
	wchar_t Email[100];
	wchar_t Sothich[100][1000];
};
wchar_t* copystring(wchar_t *s, FILE* fp)
{
	int i = 0;
	wchar_t c = fgetwc(fp);
	while (c == ' ')
	{
		c = fgetwc(fp);
	}
	if (c == '"')
	{
		c = fgetwc(fp);
		while (c != ',' && c != '"')
		{
			s[i] = c;
			c = fgetwc(fp);
			i++;
		}
		fseek(fp, 1L, SEEK_CUR);
	}
	else
	{
		while (c != ',' && c != '"')
		{
			s[i] = c;
			c = fgetwc(fp);
			i++;
		}
	}
	s[i] = L'\0';
	return s;
}
void copysothich(wchar_t* s, wchar_t sothich[100][1000], int &k)
{
	int i = 0, j = 0;
	k = 0;
	while (s[i] == ' ')
	{
		i++;
	}
	if (s[i] == '"')
	{
		i++;
		while (s[i] != '"')
		{
			sothich[k][j] = s[i];
			i++; j++;
			if (s[i] == '"')
			{
				sothich[k][j] = '\0';
				return;
			}
			if (s[i] == ',')
			{
				sothich[k][j] = '\0';
				k++; i++;
				j = 0;
				while (s[i] == ' ')
				{
					i++;
				}
			}
		}
	}
	else
	{
		while (s[i] != '\0')
		{
			sothich[k][j] = s[i];
			i++; j++;
			if (s[i] == ',')
			{
				sothich[k][j] = '\0';
				k++; i++;
				j = 0;
				while (s[i] == ' ')
				{
					i++;
				}
			}
		}
	}
}
void doc_1_sv(FILE* fp, SV& x, int &k)
{
	copystring(x.MSSV, fp);
	wprintf(L" %ls\n\n", x.MSSV);
	copystring(x.Ten, fp);
	wprintf(L" %ls\n\n", x.Ten);
	copystring(x.Khoa, fp);
	wprintf(L" %ls\n\n", x.Khoa);
	fwscanf_s(fp, L"%d", &x.khoa);
	wprintf(L" %d\n\n", x.khoa);
	fseek(fp, 1L, SEEK_CUR);
	copystring(x.Ngaysinh, fp);
	wprintf(L" %ls\n\n", x.Ngaysinh);
	copystring(x.Hinhanh, fp);
	wprintf(L" %ls\n\n", x.Hinhanh);
	copystring(x.Motabanthan, fp);
	wprintf(L" %ls\n\n", x.Motabanthan);
	copystring(x.Email, fp);
	wprintf(L" %ls\n\n", x.Email);
	wchar_t s[1000];
	fgetws(s, 1001, fp);
	s[wcslen(s) + 1] = '\0';
	wprintf(L" %ls\n\n", s);
	copysothich(s, x.Sothich, k);
	for (int i = 0; i <= k; i++)
	{
		wprintf(L" %ls\n\n", x.Sothich[i]);
	}
}
int dem_sv(FILE* fp)
{
	wchar_t s[1600];
	int dem = 0;
	while (feof(fp) == NULL) {
		fgetws(s, 1600, fp);
		dem++;
	}
	return dem;
}

wint_t WSTRLEN(wchar_t *s)
{
	wint_t dem = 0;
	while (s[dem] != L'\0')
	{
		dem++;
	}
	return dem;
}
wchar_t* ten_file(wchar_t *s1)
{
	wint_t a = WSTRLEN(s1);
	wchar_t *s = new wchar_t[a + 5];
	for (wint_t i = 0; i < a; i++)
	{
		s[i] = s1[i];
	}
	s[a] = L'.';
	s[a + 1] = L'h';
	s[a + 2] = L't';
	s[a + 3] = L'm';
	s[a + 4] = L'l';
	s[a + 5] = L'\0';
	return s;
}
void viet_1_sv_html(FILE* fo, SV x, int k)
{

}
void doc_mang_sv(FILE* fp, SV x, int n)
{
	fseek(fp, 0, 0);
	for (int i = 0; i < n; i++)
	{
		int k;
		wprintf(L" sinh viÃªn %d\n", i + 1);
		doc_1_sv(fp, x, k);
		FILE *fo;
		wchar_t *s = ten_file(x.MSSV);
		fo = _wfopen(s, L" wt, ccs = UTF-8");
		if (fo == NULL)
			wprintf(L"Mo file %ls that bai\n", s);
		viet_1_sv_html(fo, x, k);
	}
}
void main()
{
	_setmode(_fileno(stdout), _O_U16TEXT);
	_setmode(_fileno(stdin), _O_U16TEXT);
	FILE *fp;
	fp = _wfopen(L"data.csv", L" rt, ccs = UTF-8");
	if (fp == NULL)
		wprintf(L"Mo file csv that bai \n");
	SV x;
	int n = dem_sv(fp);
	doc_mang_sv(fp, x, n);
	fclose(fp);
}
